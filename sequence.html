<!DOCTYPE html>
<html>
<title>Sequence</title>
<script src="http://code.jquery.com/jquery-2.1.3.min.js"></script>
<link rel="stylesheet" type="text/css" href="drawperator.css" />
</head>
<body>
<table>
<thead><th>Submitter</th><th>Time</th><th>Submission</th></thead>
<tbody id="content"></tbody>
</table>
<script>
function getIllustration(illustration) {
   $.ajax({type: "GET", url: "illustration/" + illustration})
   .done(function(result) {
      var row = $('<tr />');
      row.append(
         $('<td />').text(result.user),
         $('<td />').text(result.timestamp),
         $('<td><img src="illustration/' + illustration + '/illustration" /></td>')
      );
      $('#content').prepend(row);
      if (result.predecessor > 0) {
         getPhrase(result.predecessor);
      }
   })
   .fail(function(jqXHR, textStatus) {
      $('body').prepend($('<p/>').text("Failed to load illustration " + illustration + ": " + textStatus));
   });
}

function getPhrase(phrase) {
   $.ajax({type: "GET", url: "phrase/" + phrase})
   .done(function(result) {
      var row = $('<tr />');
      row.append(
         $('<td />').text(result.user),
         $('<td />').text(result.timestamp),
         $('<td />').text(result.phrase)
      );
      $('#content').prepend(row);
      if (result.predecessor > 0) {
         getIllustration(result.predecessor);
      }
   })
   .fail(function(jqXHR, textStatus) {
      $('body').prepend($('<p/>').text("Failed to load phrase " + phrase + ": " + textStatus));
   });
}

$(function() {
   var illustrationEx = new RegExp("[\\?&]illustration=([^&#]*)").exec(location.search);
   if (illustrationEx != null) {
      getIllustration(illustrationEx[1]);   
   }
   var phraseEx = new RegExp("[\\?&]phrase=([^&#]*)").exec(location.search);
   if (phraseEx != null) {
      getPhrase(phraseEx[1]);   
   }
});
</script>
</body>
</html>